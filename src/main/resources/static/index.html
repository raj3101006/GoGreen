<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenish Plant - Premium Store</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #eaf4f0; color: #1b4332; overflow-x: hidden; }
        
        #canvas-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; pointer-events: none; }
        
        /* Glassmorphism UI */
        .glass-box { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        .overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 2000; padding: 15px; }
        
        input, textarea { width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ccc; border-radius: 10px; outline: none; font-size: 14px; }
        .btn-primary { padding: 12px; background: #2d6a4f; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; font-size: 15px; }
        .btn-primary:hover { background: #1b4332; transform: translateY(-2px); }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: rgba(255,255,255,0.9); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .logo { font-size: 24px; font-weight: 800; color: #2d6a4f; }
        nav { display: flex; gap: 20px; align-items: center; }
        nav a { font-weight: 600; cursor: pointer; text-decoration: none; color: #1b4332; }
        
        .page-section { min-height: 80vh; padding: 40px 5%; display: none; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #eee; transition: 0.3s; opacity: 0; transform: translateY(30px); }
        .card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
        
        /* ADMIN PANEL UPGRADES */
        .admin-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .metric-card { background: white; padding: 20px; border-radius: 15px; border-left: 5px solid #2d6a4f; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: left;}
        .metric-card h3 { color: gray; font-size: 14px; margin-bottom: 5px; }
        .metric-card h2 { color: #1b4332; font-size: 28px; font-weight: 800; }
        
        .admin-table { width: 100%; background: white; border-collapse: collapse; margin-top: 10px; border-radius: 10px; overflow: hidden; }
        .admin-table th, .admin-table td { padding: 15px; border-bottom: 1px solid #eee; text-align: left; }
        .status-badge { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; border: none; transition: 0.3s; }
        .status-processing { background: #ff9f00; color: white; }
        .status-shipped { background: #1ba672; color: white; }

        /* FAKE RAZORPAY UI */
        .rzp-overlay { position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.8); z-index: 6000; display: none; justify-content: center; align-items: center; }
        .rzp-box { background: white; width: 360px; border-radius: 6px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; position: relative; }
        .rzp-header { background: #02042b; color: white; padding: 25px 20px; text-align: center; position: relative; }
        .rzp-test-mode { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); font-size: 10px; padding: 3px 6px; border-radius: 3px; font-weight: bold; letter-spacing: 0.5px; }
        .rzp-body { padding: 20px; }
        .rzp-option { border: 1px solid #eee; padding: 15px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .rzp-option:hover { border-color: #3399cc; background: #f9fbfd; }
        .rzp-btn { background: #3399cc; color: white; width: 100%; padding: 15px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 10px; transition: 0.2s; }
        .rzp-btn:hover { background: #287a2; }
        .rzp-loader { border: 3px solid #f3f3f3; border-top: 3px solid #3399cc; border-radius: 50%; width: 24px; height: 24px; animation: rzpSpin 1s linear infinite; margin: 0 auto; display: none; }
        @keyframes rzpSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @media (max-width: 768px) { header { flex-direction: column; gap: 10px; } .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="loginScreen" class="overlay" style="display:flex;">
        <div class="glass-box" id="loginBox">
            <h2 style="color:#2d6a4f; font-size: 28px; margin-bottom: 5px;">üåø Greenish</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Welcome to Premium Plant Store</p>
            
            <input type="number" id="mobile" placeholder="Enter 10-Digit Mobile No.">
            <button class="btn-primary" onclick="loginUser()">Secure Login</button>
            
            <p onclick="adminLogin()" style="margin-top: 20px; font-size: 12px; color: #2d6a4f; cursor: pointer; font-weight: bold; text-decoration: underline;">Admin / Owner Access</p>
        </div>
    </div>

    <header id="navBar" style="display: none;">
        <div class="logo">üåø Greenish</div>
        <nav>
            <a onclick="showPage('shopPage')">Shop</a>
            <a onclick="showPage('orderPage')">üì¶ Orders</a>
            <a onclick="openCart()" style="background:#2d6a4f; color:white; padding:5px 15px; border-radius:20px;">
                <i class="fa-solid fa-cart-shopping"></i> Cart (<span id="cartCount">0</span>)
            </a>
            <a onclick="location.reload()" style="color: red;"><i class="fa-solid fa-power-off"></i></a>
        </nav>
    </header>

    <div id="mainApp" style="display: none;">
        <section id="shopPage" class="page-section" style="display: block;">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                <h2>Explore Full Collection</h2>
                <input type="text" id="searchBar" placeholder="Search plants..." style="width:200px; padding:10px; margin:0;" onkeyup="searchPlants()">
            </div>
            <div class="product-grid" id="plantsGrid"></div>
        </section>

        <section id="orderPage" class="page-section">
            <h2>üì¶ My Recent Orders</h2>
            <div id="ordersList" style="margin-top:20px; overflow-x:auto;"></div>
        </section>

        <section id="adminPage" class="page-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px; flex-wrap:wrap; gap:10px;">
                <h2>‚öôÔ∏è Enterprise Admin Panel</h2>
                <div style="display:flex; gap:10px;">
                    <button class="btn-primary" style="width:auto; padding:8px 15px; background: #172337;" onclick="exportCSV()"><i class="fa-solid fa-download"></i> Export CSV</button>
                    <button class="btn-primary" style="width:auto; padding:8px 15px;" onclick="fetchLiveOrders()"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
                </div>
            </div>

            <div class="admin-dashboard">
                <div class="metric-card">
                    <h3>Total Revenue</h3>
                    <h2 id="adminTotalRev">‚Çπ0</h2>
                </div>
                <div class="metric-card">
                    <h3>Total Orders</h3>
                    <h2 id="adminTotalOrders">0</h2>
                </div>
                <div class="metric-card">
                    <h3>Low Stock Alerts</h3>
                    <h2 style="color:#d90429;">2 Items</h2>
                </div>
            </div>

            <div style="overflow-x:auto;">
                <table class="admin-table" id="ordersTableForExport">
                    <thead style="background:#2d6a4f; color:white;">
                        <tr><th>Order ID</th><th>Address</th><th>Amount</th><th>Status (Click to update)</th></tr>
                    </thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <div id="cartModal" class="overlay" style="display:none;">
        <div class="glass-box" id="cartBox" style="position:relative; text-align:left;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('cartModal')"></i>
            <h2 style="margin-bottom: 15px;">Your Cart üõí</h2>
            <div id="cartItems" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;"></div>
            <div style="text-align: right; border-top: 1px solid #ccc; padding-top:10px;">
                <h3 style="color: #2d6a4f;">Total: ‚Çπ<span id="totalPrice">0</span></h3>
            </div>
            <button class="btn-primary" style="margin-top: 15px; background: #ff9f00;" onclick="openAddressForm()">Proceed to Checkout</button>
        </div>
    </div>

    <div id="checkoutModal" class="overlay" style="display:none;">
        <div class="glass-box" id="checkoutBox" style="position:relative; text-align:left;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('checkoutModal')"></i>
            <div id="checkoutForm">
                <h2>Delivery Details</h2>
                <textarea id="userAddress" placeholder="Full Delivery Address (House No, Street, City)" rows="3"></textarea>
                <button class="btn-primary" onclick="initRazorpay()">Proceed to Pay</button>
            </div>
        </div>
    </div>

    <div id="razorpayOverlay" class="rzp-overlay">
        <div class="rzp-box" id="rzpBox">
            <div class="rzp-header">
                <span class="rzp-test-mode">TEST MODE</span>
                <div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">Greenish Enterprises</div>
                <div style="font-size: 28px; font-weight: bold;">‚Çπ<span id="rzpAmount">0.00</span></div>
            </div>
            <div class="rzp-body" id="rzpBodyContent">
                <p style="font-size: 12px; color: gray; margin-bottom: 10px;">Preferred Payment Methods</p>
                <div class="rzp-option" onclick="processRazorpayPayment()">
                    <div><i class="fa-brands fa-google-pay" style="color:#1a73e8; font-size:20px;"></i> <span style="margin-left:10px; font-weight:bold;">UPI / QR</span></div>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                </div>
                <div class="rzp-option" onclick="processRazorpayPayment()">
                    <div><i class="fa-regular fa-credit-card" style="color:#333; font-size:18px;"></i> <span style="margin-left:10px; font-weight:bold;">Card</span></div>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                </div>
                <div class="rzp-option" onclick="processRazorpayPayment()">
                    <div><i class="fa-solid fa-building-columns" style="color:#333; font-size:18px;"></i> <span style="margin-left:10px; font-weight:bold;">Netbanking</span></div>
                    <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                </div>
                <button class="rzp-btn" onclick="processRazorpayPayment()">
                    <span id="rzpBtnText">Pay Now</span>
                    <div class="rzp-loader" id="rzpLoader"></div>
                </button>
                <p style="text-align: center; margin-top: 15px; font-size: 10px; color: gray;"><i class="fa-solid fa-lock"></i> Secured by Razorpay</p>
            </div>
            
            <div id="rzpSuccessState" style="display:none; text-align:center; padding: 40px 20px;">
                <i class="fa-solid fa-circle-check" style="font-size: 50px; color: #1ba672; margin-bottom: 15px;"></i>
                <h2 style="color: #1ba672;">Payment Successful</h2>
                <p style="font-size: 12px; color: gray; margin-top: 5px;">Redirecting back to merchant...</p>
            </div>
        </div>
    </div>

    <div id="finalSuccessModal" class="overlay" style="display:none;">
        <div class="glass-box" id="successBox" style="text-align:center; padding: 40px 20px;">
            <i class="fa-solid fa-circle-check" style="font-size: 50px; color: #2d6a4f; margin-bottom: 15px;"></i>
            <h2>Order Confirmed!</h2>
            <p style="margin: 10px 0;">Order ID: <b id="finalOrderId"></b></p>
            <p style="font-size: 12px; color: gray;">Data committed to Enterprise Server.</p>
            <button class="btn-primary" style="margin-top: 15px;" onclick="finishShopping()">View Orders</button>
        </div>
    </div>

    <script>
        const inventory = [
            { id: 1, name: "Monstera Deliciosa", price: 499, img: "https://images.pexels.com/photos/3125195/pexels-photo-3125195.jpeg?w=400" },
            { id: 2, name: "Snake Plant", price: 299, img: "https://images.pexels.com/photos/2123482/pexels-photo-2123482.jpeg?w=400" },
            { id: 3, name: "Ficus Bonsai", price: 899, img: "https://images.pexels.com/photos/3273934/pexels-photo-3273934.jpeg?w=400" },
            { id: 4, name: "Aloe Vera", price: 199, img: "https://images.pexels.com/photos/1334605/pexels-photo-1334605.jpeg?w=400" },
            { id: 5, name: "Red Rose Plant", price: 349, img: "https://images.pexels.com/photos/736230/pexels-photo-736230.jpeg?w=400" },
            { id: 6, name: "Peace Lily", price: 450, img: "https://images.pexels.com/photos/1105019/pexels-photo-1105019.jpeg?w=400" },
            { id: 7, name: "Areca Palm", price: 699, img: "https://images.pexels.com/photos/1084199/pexels-photo-1084199.jpeg?w=400" },
            { id: 8, name: "Spider Plant", price: 150, img: "https://images.pexels.com/photos/3125195/pexels-photo-3125195.jpeg?w=400" },
            { id: 9, name: "Rubber Plant", price: 550, img: "https://images.pexels.com/photos/2123482/pexels-photo-2123482.jpeg?w=400" },
            { id: 10, name: "Bamboo Plant", price: 299, img: "https://images.pexels.com/photos/3273934/pexels-photo-3273934.jpeg?w=400" },
            { id: 11, name: "Jade Plant", price: 250, img: "https://images.pexels.com/photos/1334605/pexels-photo-1334605.jpeg?w=400" },
            { id: 12, name: "Ceramic Pot", price: 399, img: "https://images.pexels.com/photos/6601444/pexels-photo-6601444.jpeg?w=400" }
        ];

        let cartData = [];

        // GSAP Initialization
        gsap.from("#loginBox", {scale: 0.8, opacity: 0, duration: 0.6, ease: "back.out(1.7)"});

        function loginUser() {
            let mobile = document.getElementById("mobile").value;
            if(mobile.length === 10) {
                gsap.to("#loginScreen", { opacity: 0, duration: 0.3, onComplete: () => {
                    document.getElementById("loginScreen").style.display = "none";
                    document.getElementById("navBar").style.display = "flex";
                    document.getElementById("mainApp").style.display = "block";
                    renderShop(); init3D();
                }});
            } else { alert("Enter 10-digit number!"); }
        }

        function adminLogin() {
            if(prompt("Admin ID:") === "Vivek02" && prompt("Password:") === "Vivek1234@") {
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("navBar").style.display = "flex";
                document.getElementById("mainApp").style.display = "block";
                showPage('adminPage'); init3D();
            } else { alert("Incorrect Credentials!"); }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(page => page.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
            if(pageId === 'shopPage') renderShop();
            if(pageId === 'orderPage') renderMyOrders();
            if(pageId === 'adminPage') fetchLiveOrders();
            window.scrollTo(0, 0);
        }

        function renderShop() {
            const grid = document.getElementById("plantsGrid"); grid.innerHTML = "";
            let query = document.getElementById("searchBar").value.toLowerCase();
            inventory.forEach(plant => {
                if(plant.name.toLowerCase().includes(query)) {
                    grid.innerHTML += `
                        <div class="card">
                            <img src="${plant.img}">
                            <h3 style="font-size:16px;">${plant.name}</h3>
                            <p style="font-size:18px; font-weight:bold; color:#2d6a4f; margin:10px 0;">‚Çπ${plant.price}</p>
                            <button class="btn-primary" onclick="addToCart(${plant.id})">Add to Cart</button>
                        </div>`;
                }
            });
            // GSAP Stagger Animation for Plants
            gsap.to(".card", {opacity: 1, y: 0, duration: 0.5, stagger: 0.05, ease: "power2.out"});
        }
        function searchPlants() { renderShop(); }

        function addToCart(id) {
            cartData.push(inventory.find(p => p.id === id));
            document.getElementById("cartCount").innerText = cartData.length;
            
            // Cart Icon Bounce Animation
            gsap.fromTo("#cartCount", {scale: 1.5}, {scale: 1, duration: 0.3});
            confetti({ particleCount: 30, spread: 30, origin: { y: 0.8 }, colors: ['#2d6a4f', '#ff9f00'] });
        }

        function openCart() {
            document.getElementById("cartModal").style.display = "flex";
            gsap.fromTo("#cartBox", {scale: 0.8, opacity: 0}, {scale: 1, opacity: 1, duration: 0.4, ease: "back.out(1.5)"});
            
            let list = document.getElementById("cartItems"); list.innerHTML = ""; let total = 0;
            if(cartData.length === 0) list.innerHTML = "<p style='color:gray;'>Cart is empty.</p>";
            cartData.forEach((item, index) => {
                total += item.price;
                list.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:8px 0;">
                    <span>${item.name}</span><span>‚Çπ${item.price} <i class="fa-solid fa-trash" style="color:red; cursor:pointer;" onclick="cartData.splice(${index}, 1); openCart();"></i></span></div>`;
            });
            document.getElementById("totalPrice").innerText = total;
        }

        function closeModal(modalId) { document.getElementById(modalId).style.display = "none"; }

        function openAddressForm() {
            if(cartData.length === 0) return alert("Cart is empty!");
            closeModal('cartModal'); 
            document.getElementById("checkoutModal").style.display = "flex";
            gsap.fromTo("#checkoutBox", {y: 50, opacity: 0}, {y: 0, opacity: 1, duration: 0.4});
        }

        // FAKE RAZORPAY LOGIC
        function initRazorpay() {
            let address = document.getElementById("userAddress").value;
            if(address.trim() === "") return alert("Please enter delivery address first!");
            
            closeModal('checkoutModal');
            
            // Setup Razorpay Modal
            let total = document.getElementById("totalPrice").innerText;
            document.getElementById("rzpAmount").innerText = total + ".00";
            document.getElementById("razorpayOverlay").style.display = "flex";
            
            // Pop-up animation for Razorpay box
            gsap.fromTo("#rzpBox", {y: 100, opacity: 0}, {y: 0, opacity: 1, duration: 0.4, ease: "power3.out"});
        }

        async function processRazorpayPayment() {
            // UI changes to show processing
            document.getElementById("rzpBtnText").style.display = "none";
            document.getElementById("rzpLoader").style.display = "block";
            
            // Simulate Payment Gateway Delay
            setTimeout(async () => {
                document.getElementById("rzpBodyContent").style.display = "none";
                document.getElementById("rzpSuccessState").style.display = "block";
                
                // After success, send data to Java Backend
                await sendDataToJavaBackend();
            }, 2000);
        }

        async function sendDataToJavaBackend() {
            let address = document.getElementById("userAddress").value;
            let newOrder = { id: "ORD" + Math.floor(Math.random() * 9999), total: document.getElementById("totalPrice").innerText, address: address, date: new Date().toLocaleDateString(), items: [...cartData] };

            try {
                await fetch('/api/commitTransaction', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(newOrder) });
                let localOrders = JSON.parse(localStorage.getItem('saved_orders')) || []; localOrders.push(newOrder); localStorage.setItem('saved_orders', JSON.stringify(localOrders));
                showFinalSuccess(newOrder.id);
            } catch(error) { 
                showFinalSuccess(newOrder.id);
            }
        }

        function showFinalSuccess(orderId) {
            setTimeout(() => {
                document.getElementById("razorpayOverlay").style.display = "none";
                document.getElementById("finalSuccessModal").style.display = "flex";
                document.getElementById("finalOrderId").innerText = orderId;
                
                gsap.fromTo("#successBox", {scale: 0}, {scale: 1, duration: 0.5, ease: "back.out(1.5)"});
                confetti({ particleCount: 150, spread: 80, zIndex: 6000 });
                
                // Reset states
                cartData = []; document.getElementById("cartCount").innerText = "0";
                document.getElementById("rzpBodyContent").style.display = "block";
                document.getElementById("rzpSuccessState").style.display = "none";
                document.getElementById("rzpBtnText").style.display = "block";
                document.getElementById("rzpLoader").style.display = "none";
            }, 1000);
        }

        function finishShopping() { closeModal('finalSuccessModal'); showPage('orderPage'); }

        function renderMyOrders() {
            let localOrders = JSON.parse(localStorage.getItem('saved_orders')) || [];
            let container = document.getElementById("ordersList"); container.innerHTML = "";
            if(localOrders.length === 0) return container.innerHTML = "<p>No orders yet.</p>";
            
            let html = "<table class='admin-table'><tr style='background:#f1f3f6;'><th>ID</th><th>Amount</th><th>Status</th></tr>";
            localOrders.reverse().forEach(order => { html += `<tr><td><b>#${order.id}</b></td><td>‚Çπ${order.total}</td><td style="color:green; font-weight:bold;">Success</td></tr>`; });
            container.innerHTML = html + "</table>";
        }

        // ADMIN PANEL UPGRADES
        function toggleStatus(btn) {
            if(btn.innerText === "Processing") {
                btn.innerText = "Shipped üöö";
                btn.className = "status-badge status-shipped";
            } else {
                btn.innerText = "Processing";
                btn.className = "status-badge status-processing";
            }
        }

        function exportCSV() {
            let table = document.getElementById("ordersTableForExport");
            let rows = table.querySelectorAll("tr");
            let csvContent = "";
            rows.forEach(row => {
                let cols = row.querySelectorAll("th, td");
                let rowData = [];
                cols.forEach(col => rowData.push('"' + col.innerText + '"'));
                csvContent += rowData.join(",") + "\n";
            });
            let blob = new Blob([csvContent], { type: 'text/csv' });
            let url = window.URL.createObjectURL(blob);
            let a = document.createElement("a");
            a.setAttribute("hidden", "");
            a.setAttribute("href", url);
            a.setAttribute("download", "sales_report.csv");
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        async function fetchLiveOrders() {
            try {
                const response = await fetch('/api/fetchOrders'); const orders = await response.json();
                let tbody = document.getElementById("adminTableBody"); tbody.innerHTML = "";
                let totalRev = 0;
                
                orders.reverse().forEach(order => {
                    totalRev += parseInt(order.total);
                    tbody.innerHTML += `<tr><td><b>#${order.id}</b></td><td>${order.address}</td><td style='color:#2d6a4f; font-weight:bold;'>‚Çπ${order.total}</td><td><button class='status-badge status-processing' onclick='toggleStatus(this)'>Processing</button></td></tr>`;
                });

                document.getElementById("adminTotalOrders").innerText = orders.length;
                document.getElementById("adminTotalRev").innerText = "‚Çπ" + totalRev;
            } catch(e) { 
                document.getElementById("adminTableBody").innerHTML = "<tr><td colspan='4'>Server Processing... Please refresh.</td></tr>"; 
            }
        }

        // 3D Background Engine
        function init3D() {
            const scene = new THREE.Scene(); const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true }); renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            const shape = new THREE.Mesh(new THREE.TorusKnotGeometry(1.5, 0.4, 100, 16), new THREE.MeshStandardMaterial({ color: 0x40916c, wireframe: true }));
            scene.add(shape); const light = new THREE.PointLight(0xffffff, 1); light.position.set(10, 10, 10); scene.add(light); camera.position.z = 6;
            function animate() { requestAnimationFrame(animate); shape.rotation.x += 0.005; shape.rotation.y += 0.005; renderer.render(scene, camera); } animate();
        }
    </script>
</body>
</html>
